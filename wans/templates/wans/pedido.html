{% extends 'wans/nav_base.html' %}
{% load static %}

{% block content %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/pedido.css' %}">

    <!-- Geocoding -->
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />

    <!-- Load Leaflet from CDN -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
    integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
    crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
    integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
    crossorigin=""></script>

    <!-- Load Esri Leaflet from CDN -->
    <script src="https://unpkg.com/esri-leaflet@2.3.1/dist/esri-leaflet.js"
    integrity="sha512-Np+ry4Dro5siJ1HZ0hTwn2jsmu/hMNrYw1EIK9EjsEVbDge4AaQhjeTGRg2ispHg7ZgDMVrSDjNrzH/kAO9Law=="
    crossorigin=""></script>

    <!-- Load Esri Leaflet Geocoder from CDN -->
    <link rel="stylesheet" href="https://unpkg.com/esri-leaflet-geocoder@2.3.1/dist/esri-leaflet-geocoder.css"
    integrity="sha512-v5YmWLm8KqAAmg5808pETiccEohtt8rPVMGQ1jA6jqkWVydV5Cuz3nJ9fQ7ittSxvuqsvI9RSGfVoKPaAJZ/AQ=="
    crossorigin="">
    <script src="https://unpkg.com/esri-leaflet-geocoder@2.3.1/dist/esri-leaflet-geocoder.js"
    integrity="sha512-YUgyCwPXzSCFuYgNIsumhktAolzwxETPBwc+xAgJOW7B3/1r1EKf0WYpmNo+6a/9C/EAF9RxYnMynEmd+77fTA=="
    crossorigin=""></script>

    <section>
        <div id="1">
            <h1>Primera pagina</h1>
            <div class="pag">
                <div style="background: yellow"></div>
                <div></div>
                <div></div>
            </div>
            <div class="pregunta">
                <div>Descripci贸n del problema</div>
                <input type="text" class="presentacion">
            </div>
        </div>
        <div id="2">
            <h1>Segunda pagina</h1>
            <div class="pag">
                <div style="background: yellow"></div>
                <div></div>
                <div></div>
            </div>
            <div class="pregunta">
                <div>Ubicaci贸n</div>
                <p>Para buscar su ubicacion, ponga en el buscador a la izquierda su calle, el numero y el codigo postal.</p>
                <br><br>
                <b class="resultado"></b>
                <a class="confirmar">Confirmar ubicaci贸n</a>
                <div id="map"></div>
            </div>
        </div>
        <div id="3">
            <div>Tercera pagina</div>
            <p>Usuario: {{ user.username }}</p>
            <p id="dir"></p>
            <form method="POST">
                {% csrf_token %}
                {% for f in form %}
                    <p class="hide">{{ f }}</p>
                {% endfor %}
                <button class="subir" type="submit">Subir</button>
            </form>
        </div>

        <button onclick="pasarPagina(false)" class="prev">Anterior</button>
        <button onclick="pasarPagina(true)" class="next">Siguiente</button>
    </section>
    <script>
var activa = 0;

$(document).ready(function(){
    pasarPagina(true);
    $('.hide').hide();
});

var pasarPagina = function(sentido){
    $('#1').hide();
    $('#2').hide();
    $('#3').hide();
    sentido ? activa += 1 : activa -= 1;
    $('#' + activa).show();
};

var map = L.map('map').setView([-34.78, -58.20], 14);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {attribution: '&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(map);

var searchControl = L.esri.Geocoding.geosearch().addTo(map);
var geocodeService = L.esri.Geocoding.geocodeService();

var results = L.layerGroup().addTo(map);

searchControl.on('results', function (data) {
    $('.resultado').text(data.text);
    $('#dir').text('Direcci贸n: ' + data.text);
    var presentacion = $('.presentacion').val();
    $('#id_presentacion').val(presentacion);
    $("#id_ubicacion").val(data.text);
    $("#id_latitud").val(data.latlng.lat);
    $("#id_longitud").val(data.latlng.lng);
    results.clearLayers();
    for (var i = data.results.length - 1; i >= 0; i--) {
      results.addLayer(L.marker(data.results[i].latlng));
    }
});

map.on('click', function (e) {
    geocodeService.reverse().latlng(e.latlng).run(function (error, result) {
        if (error) {
            return;
        }
        L.marker(result.latlng).addTo(map).bindPopup(result.address.Match_addr).openPopup();
    });
});
    </script>
{% endblock %}
